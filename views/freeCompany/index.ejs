<% if (req.isAuthenticated()) { %>
    <div ng-controller="FreeCompanyCtrl" ng-init="initListMode(<%= freeCompanies %>, <%= servers %>, <%= JSON.stringify(req.user.id) %>)" flex>
<% } else { %>
    <div ng-controller="FreeCompanyCtrl" ng-init="initListMode(<%= freeCompanies %>, <%= servers %>" flex>
<% } %>

    <div layout="row" layout-margin>
        <md-whiteframe class="md-whiteframe-z1" flex>
            <md-toolbar class="md-accent">
                <span class="md-toolbar-tools">Rechercher</span>
            </md-toolbar>
            <md-content class="md-padding" layout="row">
                <md-input-container class="md-accent" flex>
                    <label>Recherche par nom</label>
                    <input ng-model="search.name" />
                </md-input-container>
                <md-input-container class="md-accent">
                    <label>Recherche par serveur</label>
                    <md-select ng-model="search.server" placeholder="Recherche par serveur" style="margin-top: 1.3em;" flex required>
                        <md-option ng-value="server.name" ng-repeat="server in servers | orderBy:'name' track by server.id">{{server.name}}</md-option>
                    </md-select>
                </md-input-container>
            </md-content>
        </md-whiteframe>
    </div>

    <div layout="row" layout-margin>
        <md-whiteframe class="md-whiteframe-z1" flex>
            <md-toolbar class="md-accent">
                <span class="md-toolbar-tools">Liste des compagnies</span>
            </md-toolbar>
            <md-content>
                <md-list layout="column">
                    <md-list-item ng-click="to('/free-company/show/' + fc.id)" ng-repeat="fc in results = (freeCompanies | filter:search)">
                        <img class="company-logo" src="/images/fcicons/{{fc.icon}}" />
                        <span class="company-tag">[{{fc.tag}}]</span>
                        <div layout="column" layout-gt-sm="row" flex>
                            <span flex layout-gt-sm="row" layout="column">
                                <a class="company-name" href="/free-company/show/{{fc.id}}">{{fc.name}}</a>
                                <span class="company-server">(sur {{fc.server}})</span>
                            </span>
                            <span class="company-size">{{fc.realPlayersCount}} joueur<span ng-show="fc.realPlayersCount > 1">s</span></span>
                        </div>
                        <md-divider ng-if="!$last"></md-divider>
                    </md-list-item>
                </md-list>
                <p class="md-padding" ng-hide="results.length">Aucune compagnie n'a été trouvée.</p>
            </md-content>
        </md-whiteframe>
    </div>
</div>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement":
  [
    {
      "@type": "ListItem",
      "position": 1,
      "item":
      {
        "@id": "http://xivrp.com/compagnies-libres/",
        "name": "Compagnies Libres"
      }
    }
  ]
}
</script>